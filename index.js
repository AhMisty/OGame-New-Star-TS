const StringToInteger=(t)=>parseInt(t?.replaceAll(".",""))|0;var StringToInteger_default=StringToInteger;const SetValue=(t,u,v,w,x,y,z={index:0})=>{let A=w.body.indexOf(x,z.index);if(A<0)return A=void 0,!1;let B=w.body.indexOf(y,A+x.length);if(B<0)return A=void 0,B=void 0,!1;z.index=B+y.length;if(v)t[u]=StringToInteger_default(w.body.slice(A+x.length,B));else t[u]=w.body.slice(A+x.length,B);return !0};var SetValue_default=SetValue;const CheckHeader=(t)=>{let u=0,v=t.length;for(;u<v;u++)if(t[u].toUpperCase()=="LOCATION"&&t[++u].includes("index.php?code="))return v=void 0,u=void 0,!1;v=void 0;u=void 0;return !0};var CheckHeader_default=CheckHeader;const CheckHeaderLogin=(t)=>{let u=0,v=t.length;for(;u<v;u++)if(t[u].toUpperCase()=="LOCATION"&&t[++u].includes("game.php"))return !0;v=void 0;u=void 0;return !1};var CheckHeaderLogin_default=CheckHeaderLogin,ElementSet=class t extends Map{_cost;get cost(){return this._cost}_value;get value(){return this._value}_operate(u,v,w){let x=w.get(u);if(x)this._value+=x.value*v,this._cost+=x.cost*v;else this._value+=v,this._cost+=v;x=void 0}_addExistence(u,v,w,x){this.set(u,v+w),this._operate(u,w,x)}_subExistence(u,v,w,x){let y=v-w;if(y>0)this.set(u,y),this._operate(u,-w,x);else this.delete(u),this._operate(u,-v,x);y=void 0}_add(u,v,w){let x=this.get(u);if(x)this._addExistence(u,x,v,w),x=void 0;else this.set(u,v),this._operate(u,v,w)}_sub(u,v,w){let x=this.get(u);if(x)this._subExistence(u,x,v,w),x=void 0}_set(u,v,w){this._operate(u,v-(this.get(u)||0),w),this.set(u,v)}toString(u=""){let v=[],w;for(w of this)v.push(`${encodeURIComponent(u)}${w[0]}=${w[1]}`);w=void 0;return v.join("&")}add(u,v,w){if(u>0){if(v>0)this._add(u,v,w);else if(v<0)this._sub(u,-v,w)}return this}sub(u,v,w){if(u>0){if(v>0)this._sub(u,v,w);else if(v<0)this._add(u,-v,w)}return this}update(u,v,w){let x=u.length-1;for(;x>=0;x--)if(u[x]>0&&v[x]>0)this._set(u[x],v[x],w);x=void 0;return this}clone(u){return new t(void 0,void 0,u,this)}union(u,v){let w;for(w of u)this._add(...w,v);w=void 0;return this}cloneUnion(u,v){let w=new t(void 0,void 0,v,this),x;for(x of u)w._add(...x,v);x=void 0;return w}intersection(u,v){let w,x;for(w of this)if(x=u.get(w[0]),x)this._addExistence(...w,x,v);else this.delete(w[0]),this._operate(w[0],-w[1],v);x=void 0;w=void 0;return this}intersectionSub(u,v){let w,x;for(w of this)if(x=u.get(w[0]),x)this._subExistence(...w,x,v);else this.delete(w[0]),this._operate(w[0],-w[1],v);x=void 0;w=void 0;return this}cloneIntersection(u,v){let w=new t(),x,y;for(x of this)if(y=u.get(x[0]),y)w._addExistence(x[0],0,x[1]+y,v);y=void 0;x=void 0;return w}cloneIntersectionSub(u,v){let w=new t(),x,y,z;for(x of this)if(y=u.get(x[0]),y){if(z=x[1]-y,z>0)w._addExistence(x[0],0,z,v)}z=void 0;y=void 0;x=void 0;return w}difference(u,v){let w;for(w of u)this._sub(...w,v);w=void 0;return this}cloneDifference(u,v){let w=new t(),x,y,z;for(x of this)if(y=u.get(x[0]),y){if(z=x[1]-y,z>0)w._addExistence(x[0],0,z,v)}else w._addExistence(x[0],0,x[1],v);z=void 0;y=void 0;x=void 0;return w}constructor(u,v,w,x){if(x)super(x),this._cost=x._cost,this._value=x._value;else if(super(),this._cost=0,this._value=0,u&&v&&w){let y=u.length-1;for(;y>=0;y--)if(u[y]>0&&v[y]>0)this.set(u[y],v[y]),this._operate(u[y],v[y],w);y=void 0}}},Planet$1=function(t){return t[t["Planet"]=1]="Planet",t[t["Debris"]=2]="Debris",t[t["Moon"]=3]="Moon",t}(Planet$1||{}),Planet_default=Planet$1,Coordinate=class extends Array{set(t,u){let v=t.split(":");this[0]=Math.min(StringToInteger_default(v[0]),u.MaxGalaxy);this[1]=Math.min(StringToInteger_default(v[1]),u.MaxSystem);this[2]=Math.min(StringToInteger_default(v[2]),u.MaxPlanet);v=void 0}toString(){return `${this.join(":")}`}constructor(t,u){super(3),this.set(t,u)}},Coordinate_default=Coordinate,Planet=class{coordinate;elements;update(t,u,v,w,x,y,z,A){this.name=t,this.coordinate.set(u,z),this.size=v,this.used=w,this.elements.update(x,y,A)}constructor(t,u,v,w,x,y,z,A,B){this.type=t,this.name=u,this.size=w,this.used=x,this.coordinate=new Coordinate_default(v,A),this.elements=new ElementSet(y,z,B)}},PlanetSet=class t extends Map{update(u,v,w,x,y,z,A,B,C,D){let E=this.get(u);if(E)E.update(w,x,y,z,A,B,C,D);else this.set(u,new Planet(v,w,x,y,z,A,B,C,D));E=void 0;return}clone(){return new t(this)}sub(u){let v;for(v of u)this.delete(v[0]);v=void 0;return this}constructor(u){super(u)}},FleetTask=class extends ElementSet{id=crypto.randomUUID();token="";nextTime=Date.now();isEnable=!0;constructor(t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){super(E,F,H),this.cp=t,this.galaxy=u,this.system=v,this.planet=w,this.type=x,this.mission=y,this.speed=z,this.staytime=A,this.metal=B,this.crystal=C,this.deuterium=D,this.timeout=G}},FleetTaskQueue=class extends Array{add(t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){this.addTask(new FleetTask(t,u,v,w,x,y,z,A,B,C,D,E,F,G,H))}addTask(t){let u=t.nextTime,v=0;for(;v<this.length;v++)if(this[v].nextTime>u){this.splice(v,0,t);v=void 0;u=void 0;return}v=void 0;u=void 0;this.push(t);return}delete(t){let u=0;for(;u<this.length;u++)if(this[u].id==t)return this.splice(u,1),u=void 0,!0;u=void 0;return !1}disable(t){let u=0;for(;u<this.length;u++)if(this[u].id==t)return this[u].isEnable=!1,!0;u=void 0;return !1}enable(t){let u=0;for(;u<this.length;u++)if(this[u].id==t)return this[u].isEnable=!0,!0;u=void 0;return !1}async run(t){let u=Date.now(),v=0,w;for(;v<this.length;v++)if(this[v].nextTime<=u&&this[v].isEnable)await t.executeFleetTask(this[v]),w=this.splice(v--,1)[0],w.nextTime=Date.now()+w.timeout,this.addTask(w);else break;w=void 0;v=void 0;u=void 0}},Account=class{id=NaN;cookie="";ip;darkmatter=NaN;antimatter=NaN;stardust=NaN;container=NaN;elements=new ElementSet();planets=new PlanetSet();fleetTasks=new FleetTaskQueue();isValid=!0;isEnable=!1;check(){if(this.isEnable&&this.isValid)return !0;else return !1}async login(){let t=await this.config.Request({path:"/index.php?page=login",method:"POST",body:Buffer.from(`uni=${encodeURIComponent(this.uni)}&username=${encodeURIComponent(this.name)}&password=${encodeURIComponent(this.password)}`),headers:["Content-Type","application/x-www-form-urlencoded","Forwarded",`for=${this.ip}`]},CheckHeaderLogin_default),u=0,v=t.header.length,w=!1;for(;u<v;u++)if(t.header[u].toUpperCase()=="SET-COOKIE"){this.cookie=t.header[++u].split(";")[0];w=!0;break}v=void 0;u=void 0;if(w)if(w=void 0,SetValue_default(this,"id",!0,t,"Playercard(",","))return t=void 0,!0;else return t=void 0,!1;else return w=void 0,t=void 0,this.isValid=!1,!1}async post(t,u,v=0){let w=await this.config.Request({path:t,method:"POST",body:u,headers:["Content-Type","application/x-www-form-urlencoded","Cookie",this.cookie,"Forwarded",`for=${this.ip}`]},CheckHeader_default);if(w.body)return w;else if(w=void 0,v<3&&await this.login())return this.post(t,u,++v);else return}async get(t,u=0){let v=await this.config.Request({path:t,method:"GET",body:void 0,headers:["Cookie",this.cookie,"Forwarded",`for=${this.ip}`]},CheckHeader_default);if(v.body)return v;else if(v=void 0,u<3&&await this.login())return this.get(t,++u);else return}async update(){let t=await this.get("/game.php?page=control");if(t){let u={index:0};SetValue_default(this,"id",!0,t,"Playercard(",",",u);SetValue_default(this,"darkmatter",!0,t,"darkmatter\" name=\"","\"",u);SetValue_default(this,"antimatter",!0,t,"antimatter\" name=\"","\"",u);SetValue_default(this,"stardust",!0,t,"stardust\" name=\"","\"",u);SetValue_default(this,"container",!0,t,"container\" name=\"","\"",u);let v=[],w=[],x=0;for(;x<this.config.ControlListLength;x++)SetValue_default(v,x,!0,t,"gebaeude/",".",u);v[9]=921;v[10]=922;v[11]=923;u.index=t.body.indexOf("ipper_planets",u.index);for(x=0;x<this.config.ControlListLength;x++)SetValue_default(w,x,!0,t,"imper_block_td\">","<",u);this.elements.update(v,w,this.tariff);let y=[0,0,"","",0,0];while((u.index=t.body.indexOf("class=\"imper_f",u.index))>-1){SetValue_default(y,2,!1,t,"imper_"," ",u);if(y[2]=="moon")y[0]=Planet_default.Moon;else y[0]=Planet_default.Planet;SetValue_default(y,1,!0,t,"overview&cp=","\"",u);SetValue_default(y,2,!1,t,">","<",u);SetValue_default(y,3,!1,t,"[","]",u);SetValue_default(y,4,!0,t,"info_text\">"," ",u);SetValue_default(y,5,!0,t," "," ",u);for(x=0;x<this.config.ControlListLength;x++)SetValue_default(w,x,!0,t,"imper_block_td\">","<",u);this.planets.update(...y,v,w,this.config,this.tariff)}y=void 0;x=void 0;w=void 0;v=void 0;u=void 0;t=void 0}}async start(){if(!this.isEnable&&this.isValid){this.isEnable=!0;while(!0)if(this.check())await this.update(),await this.fleetTasks.run(this);else return}}stop(){this.isEnable=!1}async executeFleetTask(t){let u=await this.post(`/game.php?page=fleetStep1&cp=${t.cp}`,Buffer.from(t.toString("ship")));if(u){if(SetValue_default(t,"token",!1,u,"token\" value=\"","\"")){if(u=void 0,await this.post(`/game.php?page=fleetStep2&cp=${t.cp}`,Buffer.from(`token=${t.token}&galaxy=${t.galaxy}&system=${t.system}&planet=${t.planet}&type=${t.type}&speed=${t.speed}`))&&(await this.post(`/game.php?page=fleetStep3&cp=${t.cp}`,Buffer.from(`token=${t.token}&mission=${t.mission}&staytime=${t.staytime}&metal=${t.metal}&crystal=${t.crystal}&deuterium=${t.deuterium}`)))?.body.includes("fleettab11"))return !0}u=void 0}return !1}constructor(t,u,v,w,x,y){if(this.uni=t,this.name=u,this.password=v,this.config=w,this.tariff=x,y)this.ip=y;else this.ip=w.RandomIP()}},src_default={Account};export {src_default as default};